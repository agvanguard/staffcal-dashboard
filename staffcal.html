<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StaffCal - CHT Staffing Calendar Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .dashboard {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            padding: 30px;
            text-align: center;
            color: white;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .header .subtitle {
            font-size: 1.2em;
            margin-top: 10px;
            color: rgba(255, 255, 255, 0.9);
            font-weight: 300;
        }

        .controls {
            padding: 30px;
            background: #f8fafc;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            align-items: center;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .control-group label {
            font-weight: 600;
            color: #374151;
            font-size: 14px;
        }

        select, input {
            padding: 12px 16px;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            font-size: 14px;
            transition: all 0.3s ease;
            background: white;
        }

        select:focus, input:focus {
            outline: none;
            border-color: #4facfe;
            box-shadow: 0 0 0 3px rgba(79, 172, 254, 0.1);
        }

        .button {
            background: #10b981;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .main-content {
            padding: 30px;
        }

        .calendar-container {
            background: white;
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            overflow: hidden;
        }

        .calendar-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .nav-button {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            padding: 10px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .nav-button:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 1px;
            background: #e2e8f0;
        }

        .day-header {
            padding: 15px;
            background: #374151;
            color: white;
            font-weight: 600;
            text-align: center;
            font-size: 14px;
        }

        .calendar-day {
            min-height: 140px;
            border: none;
            padding: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: white;
            position: relative;
        }

        .calendar-day:hover {
            background: #f0f9ff;
            transform: scale(1.02);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            z-index: 10;
        }

        .day-number {
            font-weight: 600;
            margin-bottom: 6px;
            color: #374151;
            font-size: 14px;
            text-align: center;
        }

        .team-info {
            margin-bottom: 4px;
            padding: 4px;
            border-radius: 4px;
            font-size: 10px;
            line-height: 1.2;
            border: 1px solid #e2e8f0;
            background: #f8fafc;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            backdrop-filter: blur(10px);
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 20px;
            max-width: 600px;
            width: 90%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
        }

        .modal h3 {
            color: #374151;
            margin-bottom: 20px;
            font-size: 1.5em;
        }

        .close-modal {
            position: absolute;
            top: 15px;
            right: 20px;
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #6b7280;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @media (max-width: 768px) {
            .controls { flex-direction: column; align-items: stretch; }
            .calendar-day { min-height: 100px; padding: 4px; }
            .team-info { padding: 2px; font-size: 8px; }
        }
    </style>
</head>
<body>
    <div class="dashboard">
        <div class="header">
            <div style="display: flex; align-items: center; justify-content: center; gap: 20px;">
                <div style="width: 60px; height: 60px;">
                    <svg width="60" height="60" viewBox="0 0 200 200">
                        <rect x="20" y="40" width="160" height="140" rx="20" fill="white" stroke="#1e3a8a" stroke-width="8"/>
                        <circle cx="65" cy="20" r="15" fill="#1e3a8a"/>
                        <circle cx="135" cy="20" r="15" fill="#1e3a8a"/>
                        <rect x="55" y="8" width="20" height="25" rx="10" fill="#06b6d4"/>
                        <rect x="125" y="8" width="20" height="25" rx="10" fill="#06b6d4"/>
                        <rect x="30" y="50" width="140" height="25" fill="#f97316"/>
                        <circle cx="80" cy="115" r="8" fill="#1e3a8a"/>
                        <circle cx="120" cy="115" r="8" fill="#1e3a8a"/>
                        <path d="M 70 135 Q 100 155 130 135" stroke="#1e3a8a" stroke-width="4" fill="none"/>
                        <rect x="60" y="150" width="20" height="15" rx="3" fill="#06b6d4"/>
                        <rect x="90" y="150" width="20" height="15" rx="3" fill="#f97316"/>
                        <rect x="120" y="150" width="20" height="15" rx="3" fill="#fbbf24"/>
                        <rect x="50" y="180" width="25" height="15" rx="12" fill="#1e3a8a"/>
                        <rect x="125" y="180" width="25" height="15" rx="12" fill="#1e3a8a"/>
                    </svg>
                </div>
                <h1 style="font-size: 3em; margin: 0;">StaffCal</h1>
            </div>
            <div class="subtitle">CHT Staffing Calendar Dashboard</div>
        </div>

        <div class="controls">
            <div class="control-group">
                <label>üìä Data Management</label>
                <div style="display: flex; flex-wrap: wrap; gap: 12px;">
                    <input type="file" id="csvFile" accept=".csv" style="display: none;">
                    <button class="button" onclick="document.getElementById('csvFile').click()">üìÇ Import CSV</button>
                    <button class="button" onclick="downloadCSV()" style="background: #0891b2;">üìä Download CSV</button>
                    <button class="button" onclick="showHelp()" style="background: #6b7280;">‚ùì Help</button>
                    <button class="button" onclick="debugData()" style="background: #ef4444;">üîç Debug</button>
                </div>
            </div>

            <div class="control-group">
                <label>Queue (LOB)</label>
                <select id="queueFilter" onchange="updateCalendarDisplay()">
                    <option value="all">All Queues</option>
                </select>
            </div>

            <div class="control-group">
                <label>Channel</label>
                <select id="channelFilter" onchange="updateCalendarDisplay()">
                    <option value="all">All Channels</option>
                </select>
            </div>

            <div class="control-group">
                <label>üìä Data Status</label>
                <div id="dataStatus" style="padding: 8px 12px; border-radius: 8px; font-size: 12px; font-weight: 600; background: #6b7280; color: white;">
                    Ready to import
                </div>
            </div>
        </div>

        <div class="main-content">
            <div class="calendar-container">
                <div class="calendar-header">
                    <button class="nav-button" onclick="navigateMonth(-1)">‚Äπ Previous</button>
                    <h2 id="currentMonth">January 2025</h2>
                    <button class="nav-button" onclick="navigateMonth(1)">Next ‚Ä∫</button>
                </div>
                <div class="calendar-grid" id="calendarGrid"></div>
            </div>
        </div>
    </div>

    <div id="detailModal" class="modal" onclick="if(event.target===this) closeModal()">
        <div class="modal-content">
            <button class="close-modal" onclick="closeModal()">&times;</button>
            <h3 id="modalTitle">Details</h3>
            <div id="modalContent"></div>
        </div>
    </div>

    <script>
        let assembledData = [];
        let processedData = {};
        let availableQueues = new Set();
        let availableChannels = new Set();
        let currentDate = new Date();
        let dataSource = 'sample';

        const SPREADSHEET_ID = '15YqO6JxqZXKRq27ApxL9RNdW3Ujg5ps4LV7ZrmmLG34';
        const SUMMARY_TAB_GID = '1527296774';

        const sampleData = {
            '2025-01-27': {
                'Customer Service (email)': { 
                    total: 25, net_staffing: 5, required: 20, 
                    channels: ['email'], queue: 'Customer Service', channel: 'email',
                    hourly: { 8: {staffing_net: 15} }
                }
            }
        };

        function downloadCSV() {
            const csvUrl = `https://docs.google.com/spreadsheets/d/${SPREADSHEET_ID}/export?format=csv&gid=${SUMMARY_TAB_GID}`;
            const link = document.createElement('a');
            link.href = csvUrl;
            link.download = 'staffing_data.csv';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            updateDataStatus('üìä Downloading...', '#0891b2');
        }

        document.getElementById('csvFile').addEventListener('change', function(e) {
            if (!e.target.files.length) return;
            
            updateDataStatus('‚è≥ Processing...', '#fbbf24');
            
            const reader = new FileReader();
            reader.onload = (e) => setTimeout(() => parseCSV(e.target.result), 100);
            reader.readAsText(e.target.files[0]);
        });

        function parseCSV(csvText) {
            try {
                console.log('üìã Parsing CSV...');
                const lines = csvText.split('\n');
                const headers = parseCSVLine(lines[0]).map(h => h.trim().replace(/"/g, ''));
                const data = [];

                for (let i = 1; i < lines.length; i++) {
                    const line = lines[i].trim();
                    if (!line) continue;

                    const values = parseCSVLine(line);
                    const row = {};
                    headers.forEach((h, idx) => row[h] = (values[idx] || '').trim().replace(/"/g, ''));
                    
                    if (Object.values(row).some(v => v.length > 0)) {
                        data.push(row);
                    }
                }

                assembledData = data;
                console.log(`‚úÖ Parsed ${data.length} rows`);
                processDataEfficiently();

            } catch (error) {
                console.error('Parse error:', error);
                updateDataStatus('‚ùå Parse failed', '#ef4444');
            }
        }

        function processDataEfficiently() {
            console.log('üîÑ Processing data...');
            
            processedData = {};
            availableQueues.clear();
            availableChannels.clear();

            assembledData.forEach((row, i) => {
                const cols = Object.values(row);
                
                const date = formatDate(cols[0]);
                const time = cols[1] || '';
                const channel = (cols[3] || '').trim();
                const queue = (cols[4] || '').trim();
                const colF = parseFloat(cols[5] || 0);
                const colG = parseFloat(cols[6] || 0);
                const colH = parseFloat(cols[7] || 0);

                if (!date || !queue || !channel) return;

                availableQueues.add(queue);
                availableChannels.add(channel);

                const key = `${queue}|${channel}`;

                if (!processedData[date]) processedData[date] = {};
                if (!processedData[date][key]) {
                    processedData[date][key] = {
                        queue, channel,
                        sumF: 0, sumG: 0,
                        hourly: {}
                    };
                }

                processedData[date][key].sumF += colF;
                processedData[date][key].sumG += colG;

                const hour = extractHourFromTime(time);
                if (hour !== null) {
                    if (!processedData[date][key].hourly[hour]) {
                        processedData[date][key].hourly[hour] = { staffing_net: 0 };
                    }
                    processedData[date][key].hourly[hour].staffing_net += colH;
                }
            });

            // Calculate daily values
            Object.values(processedData).forEach(dateData => {
                Object.values(dateData).forEach(qData => {
                    qData.total = qData.sumF / 7.5;
                    qData.required = qData.sumG / 7.5;
                    qData.net_staffing = qData.total - qData.required;
                    delete qData.sumF;
                    delete qData.sumG;
                });
            });

            dataSource = 'assembled';
            updateFilterDropdowns();
            updateCalendarDisplay();
            updateDataStatus(`‚úÖ ${assembledData.length} records loaded`, '#10b981');
            console.log('‚úÖ Processing complete');
        }

        function extractHourFromTime(timeStr) {
            try {
                const t = timeStr.toString().trim().toLowerCase();
                
                if (t.includes('am') || t.includes('pm')) {
                    const isPM = t.includes('pm');
                    const timePart = t.replace(/\s*(am|pm)/g, '').trim();
                    
                    if (timePart.includes(':')) {
                        let hour = parseInt(timePart.split(':')[0]);
                        if (isNaN(hour)) return null;
                        
                        if (isPM && hour !== 12) hour += 12;
                        else if (!isPM && hour === 12) hour = 0;
                        
                        return (hour >= 0 && hour <= 23) ? hour : null;
                    }
                }
                
                if (t.includes(':')) {
                    const hour = parseInt(t.split(':')[0]);
                    return (hour >= 0 && hour <= 23) ? hour : null;
                }
                
                return null;
            } catch { return null; }
        }

        function parseCSVLine(line) {
            const result = [];
            let current = '';
            let inQuotes = false;
            
            for (let i = 0; i < line.length; i++) {
                if (line[i] === '"') inQuotes = !inQuotes;
                else if (line[i] === ',' && !inQuotes) {
                    result.push(current);
                    current = '';
                } else current += line[i];
            }
            result.push(current);
            return result;
        }

        function formatDate(dateStr) {
            if (!dateStr) return new Date().toISOString().split('T')[0];
            
            if (dateStr.includes('/')) {
                const [m, d, y] = dateStr.split('/');
                return `${y}-${m.padStart(2, '0')}-${d.padStart(2, '0')}`;
            }
            
            const date = new Date(dateStr);
            return !isNaN(date) ? date.toISOString().split('T')[0] : new Date().toISOString().split('T')[0];
        }

        function updateDataStatus(msg, color) {
            const el = document.getElementById('dataStatus');
            el.textContent = msg;
            el.style.backgroundColor = color;
        }

        function showLoadingOverlay(show) {
            let overlay = document.getElementById('loadingOverlay');
            
            if (show && !overlay) {
                overlay = document.createElement('div');
                overlay.id = 'loadingOverlay';
                overlay.style.cssText = 'position: fixed; inset: 0; background: rgba(0,0,0,0.8); z-index: 2000; display: flex; align-items: center; justify-content: center;';
                overlay.innerHTML = '<div style="background: white; padding: 40px; border-radius: 16px; text-align: center;"><div style="width: 60px; height: 60px; border: 4px solid #e2e8f0; border-top: 4px solid #4facfe; border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 20px;"></div><h3>Processing...</h3></div>';
                document.body.appendChild(overlay);
            } else if (!show && overlay) {
                overlay.remove();
            }
        }

        function updateFilterDropdowns() {
            const qF = document.getElementById('queueFilter');
            const cF = document.getElementById('channelFilter');
            
            qF.innerHTML = '<option value="all">All Queues</option>';
            Array.from(availableQueues).sort().forEach(q => {
                const opt = document.createElement('option');
                opt.value = opt.textContent = q;
                qF.appendChild(opt);
            });
            
            cF.innerHTML = '<option value="all">All Channels</option>';
            Array.from(availableChannels).sort().forEach(c => {
                const opt = document.createElement('option');
                opt.value = opt.textContent = c;
                cF.appendChild(opt);
            });
        }

        function getFilteredData() {
            const selQ = document.getElementById('queueFilter').value;
            const selC = document.getElementById('channelFilter').value;
            
            const source = dataSource === 'assembled' ? processedData : sampleData;
            const filtered = {};
            
            Object.entries(source).forEach(([date, dateData]) => {
                const matches = [];
                
                Object.entries(dateData).forEach(([key, qData]) => {
                    const q = qData.queue || key.split('|')[0];
                    const c = qData.channel || key.split('|')[1] || '';
                    
                    if (selQ !== 'all' && q !== selQ) return;
                    if (selC !== 'all' && c.toLowerCase() !== selC.toLowerCase()) return;
                    
                    matches.push({ queue: q, channel: c, data: qData });
                });
                
                if (!matches.length) return;
                
                const shouldAggregate = selQ === 'all' || selC === 'all';
                
                if (shouldAggregate) {
                    let name = selQ === 'all' && selC === 'all' ? 'All Queues (All Channels)' :
                               selQ === 'all' ? `All Queues (${selC})` : `${selQ} (All Channels)`;
                    
                    let sumF = 0, sumG = 0;
                    const aggHourly = {};
                    
                    matches.forEach(m => {
                        sumF += (m.data.total || 0) * 7.5;
                        sumG += (m.data.required || 0) * 7.5;
                        
                        if (m.data.hourly) {
                            Object.entries(m.data.hourly).forEach(([h, hData]) => {
                                if (!aggHourly[h]) aggHourly[h] = { staffing_net: 0 };
                                aggHourly[h].staffing_net += (hData.staffing_net || 0);
                            });
                        }
                    });
                    
                    filtered[date] = {
                        [name]: {
                            total: sumF / 7.5,
                            required: sumG / 7.5,
                            net_staffing: (sumF / 7.5) - (sumG / 7.5),
                            hourly: aggHourly,
                            displayName: name,
                            originalQueue: selQ,
                            originalChannel: selC
                        }
                    };
                } else {
                    filtered[date] = {};
                    matches.forEach(m => {
                        const key = `${m.queue} (${m.channel})`;
                        filtered[date][key] = {
                            ...m.data,
                            displayName: key,
                            originalQueue: m.queue,
                            originalChannel: m.channel
                        };
                    });
                }
            });
            
            return filtered;
        }

        function updateCalendarDisplay() {
            const months = ["January", "February", "March", "April", "May", "June",
                "July", "August", "September", "October", "November", "December"];
            
            document.getElementById('currentMonth').textContent = 
                `${months[currentDate.getMonth()]} ${currentDate.getFullYear()}`;

            const grid = document.getElementById('calendarGrid');
            grid.innerHTML = '';

            ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'].forEach(day => {
                const el = document.createElement('div');
                el.className = 'day-header';
                el.textContent = day;
                grid.appendChild(el);
            });

            const firstDay = new Date(currentDate.getFullYear(), currentDate.getMonth(), 1);
            const start = new Date(firstDay);
            start.setDate(start.getDate() - firstDay.getDay());

            const filtered = getFilteredData();
            const today = new Date();

            for (let i = 0; i < 42; i++) {
                const date = new Date(start);
                date.setDate(start.getDate() + i);
                
                const dayEl = document.createElement('div');
                dayEl.className = 'calendar-day';
                dayEl.onclick = () => showDayDetails(date);

                const num = document.createElement('div');
                num.className = 'day-number';
                num.textContent = date.getDate();
                
                if (date.getMonth() !== currentDate.getMonth()) {
                    dayEl.style.opacity = '0.4';
                    dayEl.style.backgroundColor = '#f8fafc';
                }

                if (date.toDateString() === today.toDateString()) {
                    Object.assign(num.style, {
                        backgroundColor: '#4facfe',
                        color: 'white',
                        borderRadius: '50%',
                        width: '28px',
                        height: '28px',
                        display: 'flex',
                        alignItems: 'center',
                        justifyContent: 'center',
                        margin: '0 auto'
                    });
                }

                dayEl.appendChild(num);

                const dateKey = date.toISOString().split('T')[0];
                if (filtered[dateKey]) {
                    Object.values(filtered[dateKey]).forEach(d => {
                        const info = document.createElement('div');
                        info.className = 'team-info';
                        info.innerHTML = `
                            <div style="font-weight: 600; font-size: 10px; margin-bottom: 3px;">${d.displayName}</div>
                            <div style="font-size: 8px; text-align: center;">
                                <div style="color: #1e40af;">üìä ${(d.total || 0).toFixed(1)}</div>
                                <div style="color: #1e40af;">üìã ${(d.required || 0).toFixed(1)}</div>
                                <div style="color: #059669;">üéØ ${(d.net_staffing || 0).toFixed(1)}</div>
                            </div>
                        `;
                        dayEl.appendChild(info);
                    });
                }

                grid.appendChild(dayEl);
            }
        }

        function navigateMonth(dir) {
            currentDate.setMonth(currentDate.getMonth() + dir);
            updateCalendarDisplay();
        }

        function showDayDetails(date) {
            const dateKey = date.toISOString().split('T')[0];
            const filtered = getFilteredData();
            const dayData = filtered[dateKey] || {};

            let content = `<h4>üìä ${date.toDateString()}</h4>`;

            if (Object.keys(dayData).length > 0) {
                Object.values(dayData).forEach(d => {
                    content += `
                        <div style="margin: 20px 0; border: 1px solid #e2e8f0; border-radius: 12px; overflow: hidden;">
                            <div style="background: #4facfe; color: white; padding: 12px; font-weight: 600;">${d.displayName}</div>
                            <div style="padding: 15px;">
                                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 15px;">
                                    <div style="text-align: center; padding: 10px; border: 2px solid #1e40af; border-radius: 8px;">
                                        <div style="font-weight: 600; color: #1e40af;">Scheduled</div>
                                        <div style="font-size: 18px; color: #1e40af;">${(d.total || 0).toFixed(1)}</div>
                                    </div>
                                    <div style="text-align: center; padding: 10px; border: 2px solid #1e40af; border-radius: 8px;">
                                        <div style="font-weight: 600; color: #1e40af;">Required</div>
                                        <div style="font-size: 18px; color: #1e40af;">${(d.required || 0).toFixed(1)}</div>
                                    </div>
                                    <div style="text-align: center; padding: 10px; border: 2px solid #1e40af; border-radius: 8px;">
                                        <div style="font-weight: 600; color: #1e40af;">Net Staffing</div>
                                        <div style="font-size: 18px; color: #1e40af;">${(d.net_staffing || 0).toFixed(1)}</div>
                                    </div>
                                </div>
                    `;

                    if (d.hourly && Object.keys(d.hourly).length > 0) {
                        content += `<h5>‚è∞ Hourly Breakdown (Column H):</h5>
                            <div style="display: grid; grid-template-columns: repeat(6, 1fr); gap: 4px; margin: 15px 0;">`;

                        for (let hour = 0; hour < 24; hour++) {
                            const hData = d.hourly[hour];
                            const val = hData ? hData.staffing_net : null;
                            const hasData = val !== null && val !== undefined;
                            
                            let color = '#6b7280', bg = '#f3f4f6';
                            if (hasData) {
                                if (val > 5) { color = '#059669'; bg = '#dcfce7'; }
                                else if (val >= 1) { color = '#d97706'; bg = '#fef3c7'; }
                                else { color = '#dc2626'; bg = '#fecaca'; }
                            }

                            content += `
                                <div style="text-align: center; padding: 6px 2px; background: ${bg}; border: 1px solid ${color}; border-radius: 4px; font-size: 10px;">
                                    <div style="font-weight: 600; color: ${color};">${hour.toString().padStart(2, '0')}:00</div>
                                    <div style="color: ${color}; font-weight: 600; font-size: 9px;">${hasData ? val.toFixed(3) : '-'}</div>
                                </div>
                            `;
                        }

                        content += `</div>`;
                    }

                    content += `</div></div>`;
                });
            } else {
                content += '<p style="text-align: center; color: #6b7280;">No data</p>';
            }

            showModal(date.toDateString(), content);
        }

        function showModal(title, content) {
            document.getElementById('modalTitle').textContent = title;
            document.getElementById('modalContent').innerHTML = content + 
                '<div style="text-align: center; margin-top: 20px;"><button onclick="closeModal()" style="background: #4facfe; color: white; padding: 12px 24px; border: none; border-radius: 8px; cursor: pointer;">Close</button></div>';
            document.getElementById('detailModal').classList.add('active');
        }

        function closeModal() {
            document.getElementById('detailModal').classList.remove('active');
        }

        function showHelp() {
            showModal('How to Use', `
                <div style="background: #e0f2fe; padding: 20px; border-radius: 12px;">
                    <h5>Quick Start:</h5>
                    <ol style="margin-left: 20px; line-height: 1.8;">
                        <li>Download CSV from Google Sheets</li>
                        <li>Import the CSV file</li>
                        <li>Use filters to view specific teams</li>
                        <li>Click dates for hourly details</li>
                    </ol>
                    <div style="margin-top: 15px; background: #fff; padding: 10px; border-radius: 6px;">
                        <strong>Formula:</strong><br>
                        Scheduled = Œ£(F) √∑ 7.5<br>
                        Required = Œ£(G) √∑ 7.5<br>
                        Net = Scheduled - Required<br>
                        Hourly = Œ£(H) per interval
                    </div>
                </div>
            `);
        }

        function debugData() {
            const info = {
                totalRecords: assembledData.length,
                queues: Array.from(availableQueues),
                channels: Array.from(availableChannels),
                sample: assembledData.slice(0, 3).map(r => {
                    const c = Object.values(r);
                    return { date: c[0], time: c[1], queue: c[4], channel: c[3], F: c[5], G: c[6], H: c[7] };
                })
            };
            
            showModal('Debug Info', `<pre style="font-size: 11px; overflow: auto; max-height: 400px;">${JSON.stringify(info, null, 2)}</pre>`);
        }

        function initialize() {
            processedData = sampleData;
            availableQueues = new Set(['Customer Service']);
            availableChannels = new Set(['email']);
            dataSource = 'sample';
            updateFilterDropdowns();
            updateCalendarDisplay();
        }

        initialize();
    </script>
</body>
</html>
